---
import { Image } from 'astro:assets'

// Add fonts
import '@fontsource-variable/playfair-display'
import '@fontsource/poppins'

// Assets
import logo from '~/assets/icons/logo.svg'

// Components
import Container from '~/components/container.astro'
import InnerContainer from '~/components/inner-container.astro'
import Link from '~/components/link.astro'
import { MobileNav } from '~/components/mobile-nav'
import OuterContainer from '~/components/outer-container.astro'
import { ThemeToggle } from '~/components/theme-toggle'

// Utils
import { cn } from '~/utils/helpers'

const { pathname } = Astro.url
const isActive = (path: string) => Astro.url.pathname.startsWith(path)
const isHomePage = Astro.url.pathname === '/'
---

<html>
  <head>
    <slot name="metadata" />
  </head>
  <body
    class="antialiased font-sans h-full w-full motion-safe:scroll-smooth flex flex-col bg-primary-100 text-primary-950 dark:bg-primary-900 dark:text-primary-200"
  >
    <!-- Wrapper -->
    <div class="fixed inset-0 flex justify-center sm:px-8">
      <div class="flex w-full max-w-7xl lg:px-8">
        <div
          class="w-full bg-white ring-primary-100 dark:bg-primary-950 dark:ring-primary-300/20 ring-1"
        >
        </div>
      </div>
    </div>
    <div class="relative">
      <header
        class="pointer-events-none relative z-50 flex flex-col"
        style="height: var(--header-height); margin-bottom: var(--header-mb);"
      >
        {isHomePage && (
          <>
          <div class="order-last mt-[calc(theme(spacing.16)-theme(spacing.3))]" />
          <Container
              class="top-0 order-last -mb-3 pt-3"
              style="position: var(--header-position)"
            >
              <div
                class="top-[var(--avatar-top,theme(spacing.3))] w-full"
                style="position: var(--header-inner-position)"
              >
                <div class="relative">
                  <div
                    class="absolute left-0 top-3 origin-left transition-opacity h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-primary-800/5 ring-1 ring-primary-900/5 backdrop-blur dark:bg-primary-800/90 dark:ring-white/10"
                    style="opacity: var(--avatar-border-opacity, 0); transform: var(--avatar-border-transform);"
                  >
                    <Link
                      aria-label="Go to Home Page"
                      class="pointer-events-auto block h-16 w-16 origin-left"
                      href="/"
                      style="transform: var(--avatar-image-transform)"
                    >
                      <Image
                        alt="Logo"
                        class="h-16 w-16 rounded-full bg-primary-100 object-cover dark:bg-primary-800"
                        height={64}
                        src={logo}
                        width={64}
                      />
                    </Link>
                  </div>
                </div>
              </div>
            </Container>
          </>
        )}
        <div class="top-0 z-10 h-16 pt-6" style="position: var(--header-position);">
          <Container class="top-[var(--header-top,theme(spacing.6))] w-full " style="position: var(--header-inner-position);">
            <div class="relative flex gap-4">
              <div class="flex flex-1">
                {!isHomePage && (
                  <div class={cn('h-10 w-10 rounded-full bg-white/90 p-0.5 shadow-lg shadow-primary-800/5 ring-1 ring-primary-900/5 backdrop-blur dark:bg-primary-800/90 dark:ring-white/10')}>
                    <Link
                      aria-label="Go to Home Page"
                      class="pointer-events-auto"
                      href="/"
                    >
                    <Image
                        alt="Logo"
                        class="h-9 w-9 rounded-full bg-primary-100 object-cover dark:bg-primary-800"
                        height={36}
                        src={logo}
                        width={36}
                      />
                    </Link>
                  </div>
                )}
              </div>
              <div class="flex flex-1 justify-end md:justify-center">
                <MobileNav client:only="react" currentPath={pathname} />
                <nav class="pointer-events-auto hidden md:block">
                  <ul class="bg-white/90 ring-primary-900/5 flex rounded-full px-3 text-sm font-medium shadow-lg shadow-primary-800/5 ring-1 backdrop-blur dark:bg-primary-800/90 dark:ring-white/10">
                    <li class="relative block px-3 py-2 transition">
                      <Link
                        aria-label="Go to About Page"
                        class={cn('', isActive('/about') ? 'text-accent-500 dark:text-accent-400' : 'hover:text-accent-500 dark:hover:text-accent-400')}
                        href="/about"
                      >
                        About
                        {isActive('/about') && (
                          <span
                            class="absolute bg-gradient-to-r from-accent-500 via-accent-500/40 to-accent-500 dark:from-accent-400 dark:via-accent-400/40 dark:to-accent-400 inset-x-1 -bottom-px h-px"
                          />
                        )}
                      </Link>
                    </li>
                    <li class="relative block px-3 py-2 transition">
                      <Link
                        aria-label="Go to Bookshelf Page"
                        class={cn('', isActive('/bookshelf') ? 'text-accent-500 dark:text-accent-400' : 'hover:text-accent-500 dark:hover:text-accent-400')}
                        href="/bookshelf"
                      >
                        Bookshelf
                        {isActive('/bookshelf') && (
                          <span
                            class="absolute bg-gradient-to-r from-accent-500 via-accent-500/40 to-accent-500 dark:from-accent-400 dark:via-accent-400/40 dark:to-accent-400 inset-x-1 -bottom-px h-px"
                          />
                        )}
                      </Link>
                    </li>
                    <li class="relative block px-3 py-2 transition">
                      <Link
                        aria-label="Go to Projects Page"
                        class={cn('', isActive('/projects') ? 'text-accent-500 dark:text-accent-400' : 'hover:text-accent-500 dark:hover:text-accent-400')}
                        href="/projects"
                      >
                        Projects
                        {isActive('/projects') && (
                          <span
                            class="absolute bg-gradient-to-r from-accent-500 via-accent-500/40 to-accent-500 dark:from-accent-400 dark:via-accent-400/40 dark:to-accent-400 inset-x-1 -bottom-px h-px"
                          />
                        )}
                      </Link>
                    </li>
                    <li class="relative block px-3 py-2 transition">
                      <Link
                        aria-label="Go to Uses Page"
                        class={cn('', isActive('/uses') ? 'text-accent-500 dark:text-accent-400' : 'hover:text-accent-500 dark:hover:text-accent-400')}
                        href="/uses"
                      >
                        Uses
                        {isActive('/uses') && (
                          <span
                            class="absolute bg-gradient-to-r from-accent-500 via-accent-500/40 to-accent-500 dark:from-accent-400 dark:via-accent-400/40 dark:to-accent-400 inset-x-1 -bottom-px h-px"
                          />
                        )}
                      </Link>
                    </li>
                  </ul>
                </nav>
              </div>
              <div class="flex space-x-4 items-center justify-end md:flex-1">
                <!-- TODO: Locale Toggle -->
                <ThemeToggle client:only="react" />
              </div>
            </div>
          </Container>
        </div>
      </header>
      {isHomePage && (
        <div style="height: var(--content-offset);" />
      )}
      <slot name="content" />
      <footer class="mt-32">
        <OuterContainer>
          <div
            class="border-t border-primary-100 dark:border-primary-300/20 pb-16 pt-10"
          >
            <InnerContainer>
              <div
                class="flex flex-col items-center justify-between gap-6 sm:flex-row sm:items-start"
              >
                <div class="flex flex-col items-center gap-6 sm:items-start sm:gap-3">
                  <ul
                  class="font-medium flex gap-4 place-items-center text-sm md:flex-wrap md:justify-center md:gap-x-6 md:gap-y-1"
                >
                  {
                    !isHomePage && (
                      <li>
                        <Link
                          aria-label="Go to Home Page"
                          class="hover:text-accent-500 dark:hover:text-accent-400"
                          href="/"
                        >
                          Home
                        </Link>
                      </li>
                    )
                  }
                  <li>
                    <Link
                      aria-label="Go to About Page"
                      class={cn(
                        '',
                        isActive('/about')
                          ? 'text-accent-500 dark:text-accent-400'
                          : 'hover:text-accent-500 dark:hover:text-accent-400'
                      )}
                      href="/about"
                    >
                      About
                    </Link>
                  </li>
                  <li>
                    <Link
                      aria-label="Go to Bookshelf Page"
                      class={cn(
                        '',
                        isActive('/bookshelf')
                          ? 'text-accent-500 dark:text-accent-400'
                          : 'hover:text-accent-500 dark:hover:text-accent-400'
                      )}
                      href="/bookshelf"
                    >
                      Bookshelf
                    </Link>
                  </li>
                  <li>
                    <Link
                      aria-label="Go to Projects Page"
                      class={cn(
                        '',
                        isActive('/projects')
                          ? 'text-accent-500 dark:text-accent-400'
                          : 'hover:text-accent-500 dark:hover:text-accent-400'
                      )}
                      href="/projects"
                    >
                      Projects
                    </Link>
                  </li>
                  <li>
                    <Link
                      aria-label="Go to Uses Page"
                      class={cn(
                        '',
                        isActive('/uses')
                          ? 'text-accent-500 dark:text-accent-400'
                          : 'hover:text-accent-500 dark:hover:text-accent-400'
                      )}
                      href="/uses"
                    >
                      Uses
                    </Link>
                  </li>
                </ul>
                <div class="flex flex-col gap-4">
                  <div
                    class="flex flex-col items-center space-y-1 sm:items-start lg:flex-row lg:space-x-2 lg:space-y-0"
                  >
                    <div class="flex items-center space-x-1">
                      <span
                        class="text-center text-sm sm:text-right text-primary-400 dark:text-primary-500"
                        >© 2016-2023 Cody Brunner</span
                      >
                    </div>
                    <Link
                      aria-label="All Rights Reserved"
                      class="text-center text-sm sm:text-right text-primary-400 dark:text-primary-500 hover:text-accent-500 dark:hover:text-accent-400"
                      href="http://creativecommons.org/licenses/by-nc-nd/4.0"
                      rel="noopener noreferrer"
                      target="_blank"
                    >
                      All Rights Reserved
                    </Link>
                  </div>
                </div>
                </div>
                <div class="">
                  <ThemeToggle client:only="react" />
                </div>
              </div>
            </InnerContainer>
          </div>
        </OuterContainer>
      </footer>
    </div>
    <!-- Themeing Script -->
    <script is:inline>
      const theme = (() => {
        if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
          return localStorage.getItem("theme");
        }
        if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
          return "dark";
        }
        return "light";
      })();

      if (theme === "light") {
        document.documentElement.classList.remove("dark");
      } else {
        document.documentElement.classList.add("dark");
      }
      window.localStorage.setItem("theme", theme);
    </script>
  </body>
</html>
